<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>è‰²æ¿æ•™æï¼ˆå°å­¦æ ¡1å¹´ç”Ÿï¼‰</title>
   <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
   <script src="https://cdn.tailwindcss.com"></script>
   <!-- ãƒ•ã‚©ãƒ³ãƒˆãªã© -->
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Klee+One:wght@400;600&display=swap');
       body {
           font-family: 'Klee One', 'Inter', sans-serif;
           background-color: #f0f4f8; /* è–„ã„é’/ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
       }
       .stage {
           position: relative;
           background-color: #ffffff;
           border: 4px dashed #9ca3af;
           min-height: 500px;
           box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                       0 4px 6px -2px rgba(0, 0, 0, 0.05);
           overflow: hidden;
       }

       /* ä¸‰è§’å½¢ã‚³ãƒ³ãƒ†ãƒŠï¼ˆä½ç½®æ±ºã‚ã ã‘æ‹…å½“ãƒ»è¦‹ãŸç›®ã¯é€æ˜ï¼‰ */
       .triangle {
           width: 100px;
           height: 100px;
           position: absolute;
           cursor: grab;
           transition: transform 0.1s ease;
           background: transparent;
           border-radius: 0;
           box-shadow: none;
           pointer-events: none; /* å¤–å´ã®å››è§’ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘ãªã„ */
       }

       /* å®Ÿéš›ã«è¦‹ãˆã‚‹ä¸‰è§’å½¢éƒ¨åˆ† */
       .triangle-shape {
           width: 100%;
           height: 100%;
           clip-path: polygon(0% 0%, 100% 100%, 0% 100%);
           pointer-events: auto;        /* ã“ã“ã ã‘ãƒ‰ãƒ©ãƒƒã‚°/ã‚¿ãƒƒãƒ—å¯èƒ½ */
           transform-origin: 50% 50%;   /* ä¸­å¿ƒã§å›è»¢ */
           filter: drop-shadow(0 4px 4px rgba(15, 23, 42, 0.25));
       }

       /* è‰² */
       .red-color    { background-color: #ef4444; }
       .blue-color   { background-color: #3b82f6; }
       .yellow-color { background-color: #facc15; }
       .green-color  { background-color: #10b981; }

       .palette-item {
           position: static;
           cursor: pointer;
           margin-bottom: 1rem;
           transition: transform 0.1s ease, box-shadow 0.1s ease;
       }
       .palette-item:hover .triangle-shape {
           transform: translateY(-2px);
           filter: drop-shadow(0 8px 10px rgba(15, 23, 42, 0.25));
       }
   </style>
</head>
<body class="p-4 md:p-8">

   <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">ğŸ“ è‰²æ¿æ•™æã‚¢ãƒ—ãƒª</h1>
   <p class="text-center text-gray-600 mb-8">
       å³ã®ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ä¸‰è§’å½¢ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€å·¦ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§è‡ªç”±ã«å½¢ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚
       ä¸‰è§’å½¢ã‚’ã‚¿ãƒƒãƒ—ï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼‰ã™ã‚‹ã¨45åº¦å›è»¢ã—ã¾ã™ã€‚<br>
       ã‚¹ãƒ†ãƒ¼ã‚¸ã®å¤–ã«å‡ºã—ãŸè‰²æ¿ã¯è‡ªå‹•ã§æ¶ˆãˆã¾ã™ã€‚
   </p>

   <div class="flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto">
       <!-- ã‚¹ãƒ†ãƒ¼ã‚¸ (æç”»ã‚¨ãƒªã‚¢) -->
       <div id="stage" class="stage flex-grow rounded-xl p-4 lg:p-6">
           <h2 class="text-xl font-semibold text-gray-700 mb-4">ã‚¹ãƒ†ãƒ¼ã‚¸</h2>
           <div class="text-gray-400 absolute inset-0 flex items-center justify-center p-16 pointer-events-none text-center">
               <p></p>
           </div>
       </div>

       <!-- ãƒ‘ãƒ¬ãƒƒãƒˆ -->
       <div id="palette" class="w-full lg:w-64 bg-white p-6 rounded-xl shadow-lg flex-shrink-0">
           <h2 class="text-xl font-semibold text-gray-700 mb-4">ãƒ‘ãƒ¬ãƒƒãƒˆ</h2>
           <div class="flex flex-row lg:flex-col flex-wrap gap-4 lg:gap-0">

               <!-- èµ¤ã®ä¸‰è§’å½¢ -->
               <div class="triangle palette-item w-[80px] h-[80px]" data-color="red" data-rotation="0">
                   <div class="triangle-shape red-color"></div>
               </div>

               <!-- é’ã®ä¸‰è§’å½¢ -->
               <div class="triangle palette-item w-[80px] h-[80px]" data-color="blue" data-rotation="0">
                   <div class="triangle-shape blue-color"></div>
               </div>

               <!-- é»„è‰²ã®ä¸‰è§’å½¢ -->
               <div class="triangle palette-item w-[80px] h-[80px]" data-color="yellow" data-rotation="0">
                   <div class="triangle-shape yellow-color"></div>
               </div>

               <!-- ç·‘ã®ä¸‰è§’å½¢ -->
               <div class="triangle palette-item w-[80px] h-[80px]" data-color="green" data-rotation="0">
                   <div class="triangle-shape green-color"></div>
               </div>
           </div>

           <button id="clear-stage" class="mt-8 w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">
               ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
           </button>
       </div>
   </div>

   <script>
       const stage = document.getElementById('stage');
       const palette = document.getElementById('palette');
       const clearButton = document.getElementById('clear-stage');

       let activeTriangle = null;
       let currentX = 0;
       let currentY = 0;
       let isMoved = false;

       function getCoords(e) {
           if (e.touches && e.touches.length > 0) {
               return { x: e.touches[0].clientX, y: e.touches[0].clientY };
           }
           return { x: e.clientX, y: e.clientY };
       }

       function dragStart(e, element) {
           element.dataset.isDragging = 'true';
           isMoved = false;

           if (element.classList.contains('palette-item')) {
               // ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰æ–°ã—ã„ä¸‰è§’å½¢ã‚’è¤‡è£½
               activeTriangle = element.cloneNode(true);
               activeTriangle.classList.remove('palette-item');
               activeTriangle.classList.add('on-stage');
               activeTriangle.style.position = 'absolute';

               activeTriangle.style.width = '100px';
               activeTriangle.style.height = '100px';

               activeTriangle.dataset.rotation = '0';
               const shape = activeTriangle.querySelector('.triangle-shape');
               if (shape) shape.style.transform = 'rotate(0deg)';

               stage.appendChild(activeTriangle);

               const coords = getCoords(e);
               const stageRect = stage.getBoundingClientRect();

               currentX = activeTriangle.offsetWidth / 2;
               currentY = activeTriangle.offsetHeight / 2;

               activeTriangle.style.left = `${coords.x - stageRect.left - currentX}px`;
               activeTriangle.style.top = `${coords.y - stageRect.top - currentY}px`;
           } else {
               activeTriangle = element;

               const coords = getCoords(e);
               const rect = activeTriangle.getBoundingClientRect();

               currentX = coords.x - rect.left;
               currentY = coords.y - rect.top;
           }

           activeTriangle.style.zIndex = '1000';

           document.addEventListener('mousemove', drag);
           document.addEventListener('mouseup', dragEnd);
           document.addEventListener('touchmove', drag, { passive: false });
           document.addEventListener('touchend', dragEnd);

           e.preventDefault();
       }

       function drag(e) {
           if (!activeTriangle) return;
           e.preventDefault();

           isMoved = true;

           const coords = getCoords(e);
           const stageRect = stage.getBoundingClientRect();

           // ã‚¹ãƒ†ãƒ¼ã‚¸å·¦ä¸Šã‚’åŸç‚¹ã¨ã—ãŸåº§æ¨™ã«å¤‰æ›ï¼ˆã‚ã¨ã¯è‡ªç”±ã«å‹•ã„ã¦OKï¼‰
           let newX = coords.x - stageRect.left - currentX;
           let newY = coords.y - stageRect.top - currentY;

           activeTriangle.style.left = `${newX}px`;
           activeTriangle.style.top = `${newY}px`;
       }

       function dragEnd() {
           if (!activeTriangle) return;

           activeTriangle.style.zIndex = 'auto';

           const elementToClean = activeTriangle;
           activeTriangle = null;

           // â–¼ ã‚¹ãƒ†ãƒ¼ã‚¸å¤–ãªã‚‰å‰Šé™¤ï¼ˆä¸­å¿ƒåº§æ¨™ã§åˆ¤å®šï¼‰
           if (elementToClean.classList.contains('on-stage')) {
               const stageRect = stage.getBoundingClientRect();
               const rect = elementToClean.getBoundingClientRect();
               const centerX = rect.left + rect.width / 2;
               const centerY = rect.top + rect.height / 2;

               const outside =
                   centerX < stageRect.left ||
                   centerX > stageRect.right ||
                   centerY < stageRect.top ||
                   centerY > stageRect.bottom;

               if (outside) {
                   elementToClean.remove();

                   document.removeEventListener('mousemove', drag);
                   document.removeEventListener('mouseup', dragEnd);
                   document.removeEventListener('touchmove', drag);
                   document.removeEventListener('touchend', dragEnd);
                   return;
               }
           }

           // ã‚¿ãƒƒãƒ—ã‹ãƒ‰ãƒ©ãƒƒã‚°ã‹ã®åˆ¤å®šï¼ˆå›è»¢ç”¨ãƒ•ãƒ©ã‚°ï¼‰
           if (!isMoved) {
               if (elementToClean) {
                   elementToClean.dataset.isDragging = 'false';
               }
           }

           document.removeEventListener('mousemove', drag);
           document.removeEventListener('mouseup', dragEnd);
           document.removeEventListener('touchmove', drag);
           document.removeEventListener('touchend', dragEnd);
       }

       // 45åº¦å›è»¢ï¼ˆ.triangle-shape ã‚’å›ã™ï¼‰
       function rotateTriangle(element) {
           let currentRotation = parseInt(element.dataset.rotation || '0', 10);
           currentRotation = (currentRotation + 45) % 360;
           element.dataset.rotation = currentRotation;

           const shape = element.querySelector('.triangle-shape');
           if (shape) {
               shape.style.transform = `rotate(${currentRotation}deg)`;
           }
       }

       // ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
       palette.addEventListener('mousedown', (e) => {
           const item = e.target.closest('.palette-item');
           if (item) dragStart(e, item);
       });
       palette.addEventListener('touchstart', (e) => {
           const item = e.target.closest('.palette-item');
           if (item) dragStart(e, item);
       }, { passive: false });

       // ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
       stage.addEventListener('mousedown', (e) => {
           const triangle = e.target.closest('.on-stage');
           if (triangle) dragStart(e, triangle);
       });
       stage.addEventListener('touchstart', (e) => {
           const triangle = e.target.closest('.on-stage');
           if (triangle) dragStart(e, triangle);
       }, { passive: false });

       // ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—ã§å›è»¢
       stage.addEventListener('click', (e) => {
           const triangle = e.target.closest('.on-stage');
           if (triangle) {
               if (triangle.dataset.isDragging === 'false') {
                   rotateTriangle(triangle);
                   triangle.dataset.isDragging = 'true';
               } else {
                   triangle.dataset.isDragging = 'false';
               }
           }
       });

       // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
       clearButton.addEventListener('click', () => {
           if (window.confirm("ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®è‰²æ¿ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
               const stageTriangles = stage.querySelectorAll('.on-stage');
               stageTriangles.forEach(t => t.remove());
           }
       });
   </script>
</body>
</html>
